{% extends "base.html" %}

{% block title %}Dashboard - Simon Says Pi{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <!-- Spieler-Status Card -->
        <div class="card mb-4">
            <div class="card-header bg-transparent border-0">
                <h2 class="h4 mb-0">üéÆ Spieler-Status</h2>
            </div>
            <div class="card-body">
                {% if current_player %}
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <span class="badge bg-success mb-2">Angemeldet</span>
                        <h3 class="h2 mb-0">{{ current_player }}</h3>
                    </div>
                    <a href="{{ url_for('main.logout') }}" class="btn btn-outline-info">
                        <span class="me-2">üëã</span> Abmelden
                    </a>
                </div>
                <div class="mt-3">
                    <a href="{{ url_for('main.remote') }}" class="btn btn-info w-100">
                        <span class="me-2">üéõÔ∏è</span> Zum Remote Control
                    </a>
                </div>
                {% else %}
                <form action="{{ url_for('main.set_player') }}" method="post" class="player-form">
                    <div class="mb-3">
                        <label for="player_name" class="form-label">Spielername eingeben</label>
                        <div class="input-group">
                            <span class="input-group-text bg-dark border-secondary">üéÆ</span>
                            <input type="text" 
                                   class="form-control bg-dark text-light border-secondary" 
                                   id="player_name" 
                                   name="player_name" 
                                   placeholder="z.B. SimonMaster99"
                                   minlength="3"
                                   maxlength="50"
                                   required>
                        </div>
                        <div class="form-text text-muted">
                            Mindestens 3 Zeichen, maximal 50 Zeichen
                        </div>
                    </div>
                    <button type="submit" class="btn btn-info w-100">
                        <span class="me-2">‚ñ∂Ô∏è</span> Spiel starten
                    </button>
                </form>
                {% endif %}
            </div>
        </div>

        <!-- Highscore Card -->
        <div class="card">
            <div class="card-header bg-transparent border-0">
                <h2 class="h4 mb-0">üèÜ Highscore-Tabelle</h2>
            </div>
            <div class="card-body">
                {% if scores %}
                <div class="table-responsive">
                    <table class="table table-dark table-hover align-middle">
                        <thead>
                            <tr>
                                <th scope="col" class="text-info" style="width: 60px">#</th>
                                <th scope="col" class="text-info">Spieler</th>
                                <th scope="col" class="text-info text-end">Punktzahl</th>
                                <th scope="col" class="text-info text-center">Schwierigkeit</th>
                                <th scope="col" class="text-info text-end">Erreicht am</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for score in scores %}
                            <tr {% if current_player and score.name == current_player %}class="table-active"{% endif %}>
                                <th scope="row" class="fw-bold">{{ loop.index }}</th>
                                <td>
                                    <span class="d-flex align-items-center">
                                        {% if loop.index == 1 %}üëë{% elif loop.index == 2 %}ü•à{% elif loop.index == 3 %}ü•â{% else %}üéÆ{% endif %}
                                        <span class="ms-2">{{ score.name }}</span>
                                        {% if current_player and score.name == current_player %}
                                        <span class="badge bg-info ms-2">Du</span>
                                        {% endif %}
                                    </span>
                                </td>
                                <td class="text-end fw-bold">{{ score.score }}</td>
                                <td class="text-center">
                                    {% if score.difficulty == 'easy' %}
                                    <span class="badge bg-success">Easy</span>
                                    {% elif score.difficulty == 'hard' %}
                                    <span class="badge bg-danger">Hard</span>
                                    {% else %}
                                    <span class="badge bg-warning text-dark">Medium</span>
                                    {% endif %}
                                </td>
                                <td class="text-end text-muted small">
                                    {{ score.achieved_at.strftime('%d.%m.%Y %H:%M') if score.achieved_at else '-' }}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <span class="display-1 text-muted">üèÜ</span>
                    <p class="text-muted mt-3">Noch keine Highscores vorhanden.</p>
                    <p class="text-muted small">Melde dich an und starte das Spiel!</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .player-form {
        max-width: 500px;
        margin: 0 auto;
    }
    
    .table-active {
        background-color: rgba(0, 209, 178, 0.1) !important;
        border-left: 3px solid var(--accent-color);
    }
    
    .table > :not(caption) > * > * {
        background-color: transparent;
        border-bottom-color: #333;
    }
    
    .input-group-text {
        border-right: none;
    }
    
    .form-control:focus {
        background-color: #2a2a2a;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 0.2rem rgba(0, 209, 178, 0.25);
        color: white;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    // Flash Messages automatisch ausblenden
    setTimeout(function() {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
            new bootstrap.Alert(alert).close();
        });
    }, 5000);
</script>
{% endblock %}