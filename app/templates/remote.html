{% extends "base.html" %}

{% block extra_css %}
<style>
    .simon-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        max-width: 400px;
        margin: 0 auto;
    }
    .simon-btn {
        aspect-ratio: 1 / 1;
        border-radius: 15px;
        border: 4px solid #333;
        transition: all 0.1s ease;
        opacity: 0.3; /* Standardmäßig gedimmt */
        cursor: pointer;
    }
    /* Farben im Ruhezustand */
    #btn-red { background-color: red; box-shadow: 0 0 0px red; }
    #btn-green { background-color: green; box-shadow: 0 0 0px green; }
    #btn-blue { background-color: blue; box-shadow: 0 0 0px blue; }
    #btn-yellow { background-color: yellow; box-shadow: 0 0 0px yellow; }

    /* Aktiver Zustand (wenn LED am Pi leuchtet) */
    .simon-btn.active {
        opacity: 1.0;
        transform: scale(1.05);
        box-shadow: 0 0 30px currentColor;
    }

    #status-indicator { font-weight: bold; color: #00d1b2; }
</style>
{% endblock %}

{% block content %}
<div class="row justify-content-center text-center">
    <div class="col-md-6">
        <h2 class="mb-3">Remote Interface</h2>
        <p>Status: <span id="status-indicator">Warte auf Verbindung...</span></p>
        
        <div class="simon-container mb-4">
            <div id="btn-red" class="simon-btn" style="color: red;"></div>
            <div id="btn-green" class="simon-btn" style="color: green;"></div>
            <div id="btn-blue" class="simon-btn" style="color: blue;"></div>
            <div id="btn-yellow" class="simon-btn" style="color: yellow;"></div>
        </div>

        <div class="card p-3">
            <h5>Schwierigkeit ändern</h5>
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-success" onclick="changeDifficulty('easy')">Easy</button>
                <button type="button" class="btn btn-outline-warning" onclick="changeDifficulty('medium')">Medium</button>
                <button type="button" class="btn btn-outline-danger" onclick="changeDifficulty('hard')">Hard</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Verbindung zum Socket.IO Namespace /remote herstellen
    var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + '/remote');

    const statusEl = document.getElementById('status-indicator');

    // Event: Verbindung erfolgreich
    socket.on('connect', function() {
        statusEl.innerText = "Verbunden";
    });

    // Event: Simon oder Spieler aktiviert eine LED
    socket.on('led_state', function(data) {
        const btn = document.getElementById('btn-' + data.color);
        if (data.state === 'on') {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });

    // Event: Spielstatus-Nachrichten (z.B. "Simon zeigt...")
    socket.on('game_status', function(data) {
        statusEl.innerText = data.msg;
    });

    // Event: Game Over
    socket.on('game_over', function(data) {
        statusEl.innerText = "GAME OVER! Score: " + data.score;
        alert("Spiel vorbei! Dein Score: " + data.score);
    });

    // Funktion um Schwierigkeit an den Pi zu senden
    function changeDifficulty(level) {
        socket.emit('change_difficulty', {level: level});
    }
</script>
{% endblock %}