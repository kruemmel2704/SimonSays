{% extends "base.html" %}

{% block extra_css %}
<style>
    /* Das Spielfeld zentrieren */
    .game-board {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        max-width: 400px;
        margin: 0 auto;
        padding: 20px;
        background: #2c2c2c;
        border-radius: 50%; /* Rundes Simon-Design */
        border: 10px solid #333;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    .simon-btn {
        aspect-ratio: 1 / 1;
        border-radius: 20px; /* Leicht abgerundete Ecken fÃ¼r die Sektoren */
        cursor: pointer;
        opacity: 0.4; /* Gedimmt wenn aus */
        transition: all 0.1s ease;
        border: 4px solid rgba(0,0,0,0.2);
    }

    /* Die Farben */
    #btn-red { background-color: #ff0000; border-top-left-radius: 100%; }
    #btn-green { background-color: #00ff00; border-top-right-radius: 100%; }
    #btn-blue { background-color: #0000ff; border-bottom-left-radius: 100%; }
    #btn-yellow { background-color: #ffff00; border-bottom-right-radius: 100%; }

    /* Wenn aktiv (durch Server oder Klick) */
    .simon-btn.active {
        opacity: 1;
        box-shadow: 0 0 40px currentColor; /* Leuchteffekt */
        transform: scale(0.98); /* Kleiner "DrÃ¼ck"-Effekt */
    }

    /* Mitte (Status) */
    .center-status {
        grid-column: 1 / -1;
        text-align: center;
        margin-top: 20px;
        font-weight: bold;
        color: #fff;
        font-size: 1.2rem;
        min-height: 1.5em;
    }
</style>
{% endblock %}

{% block content %}
<div class="container text-center">
    <h2 class="mb-4">ðŸŽ® Remote Control</h2>

    <div class="game-board">
        <div id="btn-red" class="simon-btn" onclick="sendInput('red')"></div>
        <div id="btn-green" class="simon-btn" onclick="sendInput('green')"></div>
        <div id="btn-blue" class="simon-btn" onclick="sendInput('blue')"></div>
        <div id="btn-yellow" class="simon-btn" onclick="sendInput('yellow')"></div>
    </div>

    <div class="center-status">
        Status: <span id="status-msg" class="text-info">Verbinde...</span>
    </div>

    <div class="mt-5">
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-outline-secondary" onclick="setDifficulty('easy')">Easy</button>
            <button type="button" class="btn btn-outline-secondary" onclick="setDifficulty('medium')">Medium</button>
            <button type="button" class="btn btn-outline-secondary" onclick="setDifficulty('hard')">Hard</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Verbindung aufbauen
    var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + '/remote');

    // --- INPUT FUNKTIONEN (Vom Browser zum Pi) ---

    function sendInput(color) {
        console.log("Sende Klick: " + color);
        // 1. Visuelles Feedback sofort geben (damit es sich schnell anfÃ¼hlt)
        flashButton(color);
        
        // 2. An den Server senden
        socket.emit('remote_input', {color: color});
    }

    function setDifficulty(level) {
        socket.emit('change_difficulty', {level: level});
    }

    // --- OUTPUT FUNKTIONEN (Vom Pi zum Browser) ---

    socket.on('connect', function() {
        document.getElementById('status-msg').innerText = "Verbunden!";
        document.getElementById('status-msg').className = "text-success";
    });

    // Wenn Simon (der Computer) eine LED zeigt
    socket.on('led_state', function(data) {
        if (data.state === 'on') {
            document.getElementById('btn-' + data.color).classList.add('active');
            
            // Optional: TÃ¶ne im Browser abspielen? (Hier Platzhalter)
            // playSound(data.color); 
            
        } else {
            document.getElementById('btn-' + data.color).classList.remove('active');
        }
    });

    socket.on('game_status', function(data) {
        document.getElementById('status-msg').innerText = data.msg;
    });

    socket.on('game_over', function(data) {
        document.getElementById('status-msg').innerText = "Game Over! Score: " + data.score;
        document.getElementById('status-msg').className = "text-danger";
        // Kurzes rotes Blinken aller Buttons als Feedback
        flashAll();
    });

    // --- HILFSFUNKTIONEN ---

    function flashButton(color) {
        const btn = document.getElementById('btn-' + color);
        btn.classList.add('active');
        setTimeout(() => {
            btn.classList.remove('active');
        }, 300);
    }

    function flashAll() {
        const colors = ['red', 'green', 'blue', 'yellow'];
        colors.forEach(c => document.getElementById('btn-' + c).classList.add('active'));
        setTimeout(() => {
            colors.forEach(c => document.getElementById('btn-' + c).classList.remove('active'));
        }, 500);
    }
</script>
{% endblock %}