{% extends "base.html" %}

{% block extra_css %}
<style>
    /* Das Spielfeld zentrieren */
    .game-board {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        max-width: 400px;
        margin: 0 auto;
        padding: 20px;
        background: #2c2c2c;
        border-radius: 50%; /* Rundes Simon-Design */
        border: 10px solid #333;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    .simon-btn {
        aspect-ratio: 1 / 1;
        border-radius: 20px; /* Leicht abgerundete Ecken fÃ¼r die Sektoren */
        cursor: pointer;
        opacity: 0.4; /* Gedimmt wenn aus */
        transition: all 0.1s ease;
        border: 4px solid rgba(0,0,0,0.2);
    }

    /* Die Farben */
    #btn-red { background-color: #ff0000; border-top-left-radius: 100%; }
    #btn-green { background-color: #00ff00; border-top-right-radius: 100%; }
    #btn-blue { background-color: #0000ff; border-bottom-left-radius: 100%; }
    #btn-yellow { background-color: #ffff00; border-bottom-right-radius: 100%; }

    /* Wenn aktiv (durch Server oder Klick) */
    .simon-btn.active {
        opacity: 1;
        box-shadow: 0 0 40px currentColor; /* Leuchteffekt */
        transform: scale(0.98); /* Kleiner "DrÃ¼ck"-Effekt */
    }

    /* Mitte (Status) */
    .center-status {
        grid-column: 1 / -1;
        text-align: center;
        margin-top: 20px;
        font-weight: bold;
        color: #fff;
        font-size: 1.2rem;
        min-height: 1.5em;
    }
</style>
{% endblock %}

{% block content %}
<div class="container text-center">
    <h2 class="mb-4">ðŸŽ® Remote Control</h2>

    <div class="game-board">
        <div id="btn-red" class="simon-btn" onclick="sendInput('red')"></div>
        <div id="btn-green" class="simon-btn" onclick="sendInput('green')"></div>
        <div id="btn-blue" class="simon-btn" onclick="sendInput('blue')"></div>
        <div id="btn-yellow" class="simon-btn" onclick="sendInput('yellow')"></div>
    </div>

    <div class="center-status">
        Status: <span id="status-msg" class="text-info">Verbinde...</span>
    </div>

    <div class="mt-5">
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-outline-secondary" onclick="setDifficulty('easy')">Easy</button>
            <button type="button" class="btn btn-outline-secondary" onclick="setDifficulty('medium')">Medium</button>
            <button type="button" class="btn btn-outline-secondary" onclick="setDifficulty('hard')">Hard</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Verbindung zum Namespace /remote aufbauen
    var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + '/remote');

    const statusMsg = document.getElementById('status-msg');

    // 1. Verbindung bestÃ¤tigen
    socket.on('connect', function() {
        statusMsg.innerText = "Verbunden";
        statusMsg.className = "text-success";
    });

    // 2. DAS HERZSTÃœCK: Auf LED-Signale vom Pi reagieren
    socket.on('led_state', function(data) {
        // data enthÃ¤lt z.B. {color: 'red', state: 'on'}
        const btn = document.getElementById('btn-' + data.color);
        
        if (data.state === 'on') {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });

    // 3. Status-Nachrichten anzeigen (z.B. "Simon zeigt...")
    socket.on('game_status', function(data) {
        statusMsg.innerText = data.msg;
    });

    // 4. Game Over Handling
    socket.on('game_over', function(data) {
        statusMsg.innerText = "Game Over! Score: " + data.score;
        statusMsg.className = "text-danger";
    });

    // Funktion fÃ¼r deine eigenen Klicks (Web -> Pi)
    function sendInput(color) {
        socket.emit('remote_input', {color: color});
    }
</script>
{% endblock %}